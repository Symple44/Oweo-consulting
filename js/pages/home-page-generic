// ========================================
// js/pages/home-page-generic.js - Page d'accueil utilisant uniquement le système générique
// ========================================

class HomePageGeneric extends BasePage {
    constructor() {
        super({
            id: 'home',
            title: 'Accueil',
            description: 'Transformez votre industrie avec nos solutions innovantes'
        });
        
        // Données de la page
        this.stats = [
            { value: '150+', label: 'Clients Satisfaits', icon: 'fas fa-users' },
            { value: '500+', label: 'Projets Réalisés', icon: 'fas fa-project-diagram' },
            { value: '15', label: 'Ans d\'Expérience', icon: 'fas fa-clock' },
            { value: '98%', label: 'Satisfaction', icon: 'fas fa-award' }
        ];
        
        this.services = [
            {
                title: 'Chiffrage Intelligent',
                content: 'Estimez vos projets avec précision grâce à notre outil de chiffrage avancé',
                icon: 'fas fa-calculator',
                variant: 'primary',
                badge: { text: 'Populaire', icon: 'fas fa-star' },
                actions: [{ text: 'Découvrir', href: '#chiffrage-demo', variant: 'outline' }]
            },
            {
                title: 'Intégration DSTV',
                content: 'Importez et gérez vos fichiers DSTV/NC en toute simplicité',
                icon: 'fas fa-cube',
                variant: 'accent',
                badge: { text: 'Nouveau', variant: 'accent' }
            },
            {
                title: 'Gestion de Production',
                content: 'Optimisez votre chaîne de production avec nos outils intelligents',
                icon: 'fas fa-industry',
                actions: [{ text: 'En savoir plus', href: '#production', variant: 'ghost' }]
            }
        ];
        
        this.features = [
            {
                title: 'Expertise Métier',
                description: '15 ans d\'expérience dans la charpente métallique',
                icon: 'fas fa-check-circle'
            },
            {
                title: 'Solutions Sur Mesure',
                description: 'Des outils adaptés à vos besoins spécifiques',
                icon: 'fas fa-check-circle'
            },
            {
                title: 'Support Dédié',
                description: 'Une équipe à votre écoute 7j/7',
                icon: 'fas fa-check-circle'
            },
            {
                title: 'Innovation Continue',
                description: 'Des mises à jour régulières et des nouvelles fonctionnalités',
                icon: 'fas fa-check-circle'
            }
        ];
        
        this.testimonials = [
            {
                content: 'Une solution qui a transformé notre façon de travailler. Le gain de temps est considérable.',
                author: 'Jean Dupont',
                role: 'Directeur Production',
                company: 'MetalPro SA'
            },
            {
                content: 'Interface intuitive et fonctionnalités puissantes. Exactement ce dont nous avions besoin.',
                author: 'Marie Martin',
                role: 'Chef de Projet',
                company: 'Constructions Modernes'
            }
        ];
    }
    
    getTemplate() {
        // Utilisation du PageBuilder pour construire la page
        const page = new PageBuilder()
            // Section Hero
            .addHero({
                title: 'Transformez votre industrie métallique',
                subtitle: 'Solutions ERP',
                description: 'Expert en digitalisation pour la charpente métallique, nous créons des outils qui révolutionnent votre quotidien.',
                icon: 'fas fa-industry',
                actions: [
                    { text: 'Découvrir nos Démos', icon: 'fas fa-rocket', variant: 'primary' },
                    { text: 'Planifier un RDV', icon: 'fas fa-calendar', variant: 'outline' }
                ]
            })
            
            // Section Statistiques
            .addSection({
                background: 'surface',
                content: this.renderStats()
            })
            
            // Section Services
            .addCards(this.services, {
                title: 'Nos Solutions',
                description: 'Des outils conçus pour répondre à vos défis quotidiens',
                grid: { columns: 3 }
            })
            
            // Section Pourquoi Nous
            .addSection({
                content: this.renderWhyUs()
            })
            
            // Section Témoignages
            .addSection({
                title: 'Ils nous font confiance',
                background: 'surface',
                content: this.renderTestimonials()
            })
            
            // Section CTA
            .addSection({
                content: this.renderCTA()
            })
            
            .build();
            
        return page;
    }
    
    renderStats() {
        return `
            <div class="grid grid--4">
                ${this.stats.map((stat, index) => `
                    <div class="card center animate-on-scroll" style="animation-delay: ${index * 0.1}s;">
                        <div class="icon-box icon-box--primary mx-auto mb-md">
                            <i class="${stat.icon}"></i>
                        </div>
                        <h3 class="text-3xl font-extrabold text-gradient mb-sm" data-counter="${stat.value}">
                            0
                        </h3>
                        <p class="text-secondary">${stat.label}</p>
                    </div>
                `).join('')}
            </div>
        `;
    }
    
    renderWhyUs() {
        return `
            <div class="grid grid--2 gap-xl">
                <div class="animate-on-scroll">
                    <h2 class="text-3xl font-bold mb-lg">
                        Pourquoi Choisir ${window.CompanyInfo?.name || 'Notre Solution'} ?
                    </h2>
                    <p class="text-secondary text-lg mb-xl">
                        Nous combinons expertise métier et innovation technologique pour vous offrir 
                        des solutions qui font vraiment la différence.
                    </p>
                    
                    ${ComponentBuilder.featureList(this.features)}
                    
                    <div class="mt-xl">
                        <button class="btn btn--primary btn--lg">
                            <i class="fas fa-arrow-right"></i>
                            En savoir plus sur nous
                        </button>
                    </div>
                </div>
                
                <div class="animate-on-scroll">
                    <div class="card card--primary card--glow p-2xl center">
                        <i class="fas fa-chart-line text-4xl mb-lg"></i>
                        <h3 class="text-4xl font-extrabold mb-md">+40%</h3>
                        <p class="text-xl">de productivité</p>
                        <p class="text-sm mt-md opacity-75">en moyenne constatée par nos clients</p>
                    </div>
                    
                    <div class="grid grid--2 gap-md mt-md">
                        <div class="card center">
                            <h4 class="text-2xl font-bold text-accent">-30%</h4>
                            <p class="text-sm text-secondary">Réduction des erreurs</p>
                        </div>
                        <div class="card center">
                            <h4 class="text-2xl font-bold text-accent">2x</h4>
                            <p class="text-sm text-secondary">Plus rapide</p>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    renderTestimonials() {
        return `
            <div class="grid grid--2 gap-lg">
                ${this.testimonials.map((testimonial, index) => `
                    <div class="card card--hover animate-on-scroll" style="animation-delay: ${index * 0.1}s;">
                        <div class="flex gap-sm mb-md">
                            ${[...Array(5)].map(() => '<i class="fas fa-star text-accent"></i>').join('')}
                        </div>
                        
                        <blockquote class="text-lg mb-lg" style="font-style: italic;">
                            "${testimonial.content}"
                        </blockquote>
                        
                        <div class="flex gap-md" style="align-items: center;">
                            <div class="icon-box icon-box--outline">
                                <i class="fas fa-user"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold">${testimonial.author}</h4>
                                <p class="text-sm text-secondary">
                                    ${testimonial.role} - ${testimonial.company}
                                </p>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
    }
    
    renderCTA() {
        return `
            <div class="card card--glow p-2xl center animate-on-scroll" 
                 style="background: var(--theme-gradient-surface); border: 2px solid var(--theme-primary);">
                <h2 class="text-3xl font-bold mb-md">
                    Prêt à Transformer Votre Entreprise ?
                </h2>
                <p class="text-lg text-secondary mb-xl" style="max-width: 600px; margin-left: auto; margin-right: auto;">
                    Découvrez comment nos solutions peuvent révolutionner votre activité. 
                    Commencez avec une démonstration gratuite.
                </p>
                
                <div class="flex gap-md" style="justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn--primary btn--lg" onclick="window.location.hash='#demos'">
                        <i class="fas fa-play"></i>
                        Démarrer la Démo Gratuite
                    </button>
                    <button class="btn btn--outline btn--lg" onclick="window.location.hash='#contact'">
                        <i class="fas fa-phone"></i>
                        Parler à un Expert
                    </button>
                </div>
                
                <div class="flex gap-lg mt-xl" style="justify-content: center; opacity: 0.7;">
                    <span class="text-sm">
                        <i class="fas fa-check text-accent"></i> Sans engagement
                    </span>
                    <span class="text-sm">
                        <i class="fas fa-check text-accent"></i> Démo personnalisée
                    </span>
                    <span class="text-sm">
                        <i class="fas fa-check text-accent"></i> Support inclus
                    </span>
                </div>
            </div>
        `;
    }
    
    async onMount() {
        super.onMount();
        
        // Animer les compteurs
        this.animateCounters();
        
        // Observer pour les animations au scroll
        this.setupScrollAnimations();
        
        // Effet parallaxe léger sur le hero
        this.setupParallax();
    }
    
    animateCounters() {
        const counters = document.querySelectorAll('[data-counter]');
        
        const observerOptions = {
            threshold: 0.5,
            rootMargin: '0px'
        };
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const element = entry.target;
                    const target = element.dataset.counter;
                    this.countUp(element, target);
                    observer.unobserve(element);
                }
            });
        }, observerOptions);
        
        counters.forEach(counter => observer.observe(counter));
    }
    
    countUp(element, target) {
        const duration = 2000;
        const start = performance.now();
        
        // Extraire le nombre et le suffixe
        const match = target.match(/(\d+)(\+|%)?/);
        if (!match) return;
        
        const number = parseInt(match[1]);
        const suffix = match[2] || '';
        
        const update = (currentTime) => {
            const elapsed = currentTime - start;
            const progress = Math.min(elapsed / duration, 1);
            
            // Easing function
            const easeOutQuart = 1 - Math.pow(1 - progress, 4);
            const current = Math.floor(easeOutQuart * number);
            
            element.textContent = current + suffix;
            
            if (progress < 1) {
                requestAnimationFrame(update);
            }
        };
        
        requestAnimationFrame(update);
    }
    
    setupScrollAnimations() {
        const elements = document.querySelectorAll('.animate-on-scroll');
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        });
        
        elements.forEach(el => observer.observe(el));
    }
    
    setupParallax() {
        const hero = document.querySelector('.hero');
        if (!hero) return;
        
        let ticking = false;
        
        const updateParallax = () => {
            const scrolled = window.pageYOffset;
            const rate = scrolled * -0.5;
            
            hero.style.transform = `translateY(${rate}px)`;
            ticking = false;
        };
        
        const requestTick = () => {
            if (!ticking) {
                requestAnimationFrame(updateParallax);
                ticking = true;
            }
        };
        
        window.addEventListener('scroll', requestTick);
    }
}

// Enregistrer la page
window.HomePageGeneric = HomePageGeneric;